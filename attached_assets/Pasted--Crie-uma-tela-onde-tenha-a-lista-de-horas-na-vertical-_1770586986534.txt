

- Crie uma tela onde tenha a lista de horas na vertical, e uma barra que cresce na horizontal em cada hora com valor financeiro, para que eu possa informar quais os valores gerados em cada hora! Em react por favor!

- Eu quero um botão que o usuário possa adicionar o valor de qualquer hora sem precisar ficar clicando em cada hora! Pra isso faz sentido ao clicar pegar a hora e o dia atual real, e o usuário informar o valor, e ao criar cria a hora na lista de horas com o valor informado! Faz sentido?

- Nessa arquitetura atual permite ir crescendo a quantidade de dias de acordo com o passar dos dias? Tipo, quando não tem um dia ainda na lista, por exemplo digamos que hoje é 02 de Março, mas não tem o dia na lista de dias, ao adicionar a receita de alguma hora desse dia atual que hipoteticamente é o dia 2 de março, ao adicionar esse dia que não está na lista é criado também, sendo adicionado o dia e as horas daquele dia com receita?










import React, { useState } from 'react';
import { ArrowLeft, TrendingUp, Calendar, Clock, Plus, Trash2, MoreVertical } from 'lucide-react';

export default function RevenueTracker() {
  const [currentView, setCurrentView] = useState('days');
  const [selectedDate, setSelectedDate] = useState(null); // Agora guarda data completa
  const [editingHour, setEditingHour] = useState(null);
  const [showQuickAdd, setShowQuickAdd] = useState(false);
  const [quickAddValue, setQuickAddValue] = useState('');
  const [showOptionsMenu, setShowOptionsMenu] = useState(false);
  
  // Agora usa chave baseada em data: "2025-03-02"
  const [dailyData, setDailyData] = useState({});

  // Gera chave de data no formato YYYY-MM-DD
  const getDateKey = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  };

  // Cria estrutura de horas para um dia
  const createDayStructure = () => {
    return Array.from({ length: 24 }, (_, i) => ({
      hour: i,
      value: 0
    }));
  };

  // Garante que um dia existe na estrutura
  const ensureDayExists = (dateKey) => {
    if (!dailyData[dateKey]) {
      setDailyData(prev => ({
        ...prev,
        [dateKey]: createDayStructure()
      }));
    }
  };

  const handleQuickAdd = () => {
    const now = new Date();
    const dateKey = getDateKey(now);
    const currentHour = now.getHours();
    
    const value = parseFloat(quickAddValue);
    
    if (value && value > 0) {
      setDailyData(prev => {
        const dayData = prev[dateKey] || createDayStructure();
        return {
          ...prev,
          [dateKey]: dayData.map(item =>
            item.hour === currentHour ? { ...item, value: item.value + value } : item
          )
        };
      });
      
      setQuickAddValue('');
      setShowQuickAdd(false);
      
      // Navegar para o dia e hora atual
      setSelectedDate(dateKey);
      setCurrentView('hours');
      setTimeout(() => {
        setEditingHour(currentHour);
      }, 100);
    }
  };

  const getCurrentDayData = () => {
    return selectedDate ? (dailyData[selectedDate] || createDayStructure()) : [];
  };

  const updateValue = (hour, value) => {
    setDailyData(prev => ({
      ...prev,
      [selectedDate]: (prev[selectedDate] || createDayStructure()).map(item =>
        item.hour === hour ? { ...item, value: parseFloat(value) || 0 } : item
      )
    }));
  };

  const getDayTotal = (dateKey) => {
    if (!dailyData[dateKey]) return 0;
    return dailyData[dateKey].reduce((sum, item) => sum + item.value, 0);
  };

  const getMonthTotal = () => {
    return Object.keys(dailyData).reduce((total, dateKey) => 
      total + getDayTotal(dateKey), 0
    );
  };

  const formatCurrency = (value) => {
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL',
      minimumFractionDigits: 2
    }).format(value);
  };

  const formatHour = (hour) => {
    return `${hour.toString().padStart(2, '0')}:00`;
  };

  const getDayName = (dateKey) => {
    const [year, month, day] = dateKey.split('-').map(Number);
    const date = new Date(year, month - 1, day);
    const days = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
    return days[date.getDay()];
  };

  const formatDate = (dateKey) => {
    const [year, month, day] = dateKey.split('-').map(Number);
    const date = new Date(year, month - 1, day);
    return date.toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });
  };

  const maxValue = currentView === 'hours' 
    ? Math.max(...getCurrentDayData().map(h => h.value), 1)
    : Math.max(...Object.keys(dailyData).map(d => getDayTotal(d)), 1);

  const totalRevenue = currentView === 'hours' 
    ? getDayTotal(selectedDate) 
    : getMonthTotal();

  const quickAddAmount = (hour, amount) => {
    const current = (dailyData[selectedDate] || createDayStructure()).find(h => h.hour === hour).value;
    updateValue(hour, current + amount);
  };

  // Pega todos os dias ordenados do mais recente ao mais antigo
  const getSortedDates = () => {
    return Object.keys(dailyData)
      .filter(dateKey => getDayTotal(dateKey) > 0) // Apenas dias com receita
      .sort((a, b) => b.localeCompare(a)); // Mais recente primeiro
  };

  return (
    <div className="min-h-screen bg-slate-50">
      {/* Header Fixo */}
      <div className="sticky top-0 z-10 bg-white border-b border-slate-200 shadow-sm">
        <div className="px-4 py-4">
          <div className="flex items-center justify-between mb-3">
            {currentView === 'hours' && (
              <button
                onClick={() => {
                  setCurrentView('days');
                  setSelectedDate(null);
                  setEditingHour(null);
                  setShowOptionsMenu(false);
                }}
                className="flex items-center gap-2 text-black font-semibold active:scale-95 transition-transform"
              >
                <ArrowLeft size={20} />
                <span>Voltar</span>
              </button>
            )}
            
            {currentView === 'hours' && (
              <div className="relative ml-auto">
                <button
                  onClick={() => setShowOptionsMenu(!showOptionsMenu)}
                  className="w-9 h-9 rounded-full bg-slate-100 flex items-center justify-center active:bg-slate-200 transition-colors"
                >
                  <MoreVertical size={20} className="text-black" />
                </button>
                
                {showOptionsMenu && (
                  <>
                    {/* Backdrop para fechar menu ao clicar fora */}
                    <div 
                      className="fixed inset-0 z-10" 
                      onClick={() => setShowOptionsMenu(false)}
                    />
                    
                    {/* Menu dropdown */}
                    <div className="absolute right-0 mt-2 w-48 bg-white border border-slate-200 rounded-xl shadow-lg z-20 overflow-hidden">
                      <button
                        onClick={() => {
                          if (confirm('Limpar todas as horas deste dia?')) {
                            setDailyData(prev => ({
                              ...prev,
                              [selectedDate]: createDayStructure()
                            }));
                            setEditingHour(null);
                          }
                          setShowOptionsMenu(false);
                        }}
                        className="w-full px-4 py-3 text-left hover:bg-slate-50 active:bg-slate-100 transition-colors flex items-center gap-3 text-red-600"
                      >
                        <Trash2 size={18} />
                        <span className="font-medium">Limpar dia</span>
                      </button>
                    </div>
                  </>
                )}
              </div>
            )}
          </div>
          
          <div className="flex items-start justify-between">
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-1">
                {currentView === 'days' ? (
                  <Calendar className="text-black" size={24} />
                ) : (
                  <Clock className="text-black" size={24} />
                )}
                <h1 className="text-xl font-bold text-black">
                  {currentView === 'days' ? 'Receita Total' : formatDate(selectedDate)}
                </h1>
              </div>
              {currentView === 'hours' && (
                <p className="text-sm text-slate-500">{getDayName(selectedDate)}</p>
              )}
            </div>
            
            <div className="text-right">
              <div className="flex items-center gap-1 text-black mb-1">
                <TrendingUp size={16} />
                <span className="text-xs font-semibold">
                  {currentView === 'days' ? 'Total' : 'Dia'}
                </span>
              </div>
              <p className="text-lg font-bold text-black">
                {formatCurrency(totalRevenue)}
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* Conteúdo */}
      <div className="px-4 pb-20">
        {/* Tela de Dias */}
        {currentView === 'days' && (
          <>
            <p className="text-sm text-slate-600 my-4">
              {getSortedDates().length > 0 
                ? 'Seus dias com receita registrada' 
                : 'Nenhuma receita registrada ainda. Use o botão + para adicionar!'}
            </p>
            
            {getSortedDates().length > 0 ? (
              <div className="space-y-2">
                {getSortedDates().map(dateKey => {
                  const dayTotal = getDayTotal(dateKey);
                  const [year, month, day] = dateKey.split('-').map(Number);
                  
                  return (
                    <button
                      key={dateKey}
                      onClick={() => {
                        setSelectedDate(dateKey);
                        setCurrentView('hours');
                      }}
                      className="w-full bg-white border-2 border-slate-200 rounded-xl p-4 transition-all active:scale-98 hover:border-black"
                    >
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          <div className="w-14 h-14 bg-black text-white rounded-xl flex flex-col items-center justify-center">
                            <div className="text-xs font-semibold opacity-80">
                              {getDayName(dateKey)}
                            </div>
                            <div className="text-xl font-bold">
                              {day}
                            </div>
                          </div>
                          
                          <div className="text-left">
                            <div className="text-sm text-slate-500">
                              {formatDate(dateKey)}
                            </div>
                            <div className="text-lg font-bold text-black">
                              {formatCurrency(dayTotal)}
                            </div>
                          </div>
                        </div>
                        
                        <div className="text-slate-400">
                          →
                        </div>
                      </div>
                    </button>
                  );
                })}
              </div>
            ) : (
              <div className="flex flex-col items-center justify-center py-16 text-center">
                <div className="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4">
                  <Calendar className="text-slate-400" size={40} />
                </div>
                <p className="text-slate-500 text-sm">
                  Comece a registrar suas receitas
                </p>
              </div>
            )}

            {/* Resumo Total */}
            {getSortedDates().length > 0 && (
              <div className="mt-6 bg-white border border-slate-200 rounded-2xl p-4 shadow-sm">
                <h2 className="text-sm font-semibold text-slate-600 mb-3">Resumo Geral</h2>
                <div className="space-y-2">
                  <div className="flex justify-between items-center">
                    <span className="text-sm text-slate-600">Dias com receita</span>
                    <span className="font-bold text-black">
                      {getSortedDates().length}
                    </span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-sm text-slate-600">Média por dia</span>
                    <span className="font-bold text-black">
                      {formatCurrency(getMonthTotal() / getSortedDates().length)}
                    </span>
                  </div>
                </div>
              </div>
            )}
          </>
        )}

        {/* Tela de Horas */}
        {currentView === 'hours' && (
          <div className="mt-4 space-y-2">
            {getCurrentDayData().map(({ hour, value }) => {
              const isEditing = editingHour === hour;
              const hasValue = value > 0;
              
              return (
                <div
                  key={hour}
                  className={`
                    bg-white border border-slate-200 rounded-xl shadow-sm transition-all
                    ${isEditing ? 'ring-2 ring-black shadow-md' : ''}
                  `}
                >
                  <button
                    onClick={() => setEditingHour(isEditing ? null : hour)}
                    className="w-full p-4 text-left active:bg-slate-50 rounded-xl transition-colors"
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-16 h-16 rounded-lg bg-slate-100 border border-slate-200 flex items-center justify-center">
                          <div className="text-center">
                            <div className="text-lg font-bold text-black">
                              {formatHour(hour).split(':')[0]}
                            </div>
                            <div className="text-xs text-slate-500">h</div>
                          </div>
                        </div>
                        
                        <div className="flex-1">
                          <div className="text-sm text-slate-500 mb-1">
                            {formatHour(hour)} - {formatHour(hour + 1)}
                          </div>
                          {hasValue ? (
                            <div className="text-lg font-bold text-black">
                              {formatCurrency(value)}
                            </div>
                          ) : (
                            <div className="text-sm text-slate-400">
                              Sem receita
                            </div>
                          )}
                        </div>
                      </div>
                      
                      <div className={`
                        w-2 h-12 rounded-full transition-all
                        ${hasValue ? 'bg-black' : 'bg-slate-200'}
                      `}
                        style={{
                          transform: hasValue ? `scaleY(${Math.max(value / maxValue, 0.1)})` : 'scaleY(0.1)'
                        }}
                      />
                    </div>
                  </button>

                  {/* Painel de Edição */}
                  {isEditing && (
                    <div className="px-4 pb-4 space-y-3 border-t border-slate-200 pt-3">
                      {/* Botões Rápidos */}
                      <div className="grid grid-cols-4 gap-2">
                        {[10, 50, 100, 500].map(amount => (
                          <button
                            key={amount}
                            onClick={() => quickAddAmount(hour, amount)}
                            className="py-2 px-3 bg-black text-white rounded-lg font-semibold text-sm active:bg-slate-800 transition-colors"
                          >
                            +{amount}
                          </button>
                        ))}
                      </div>

                      {/* Input Manual */}
                      <div className="flex gap-2">
                        <input
                          type="number"
                          value={value || ''}
                          onChange={(e) => updateValue(hour, e.target.value)}
                          placeholder="0.00"
                          className="flex-1 px-4 py-3 border-2 border-slate-300 bg-white text-black rounded-lg focus:border-black focus:outline-none text-lg font-semibold"
                          step="0.01"
                          min="0"
                        />
                        {value > 0 && (
                          <button
                            onClick={() => updateValue(hour, 0)}
                            className="px-4 bg-slate-100 text-black rounded-lg active:bg-slate-200 transition-colors"
                          >
                            <Trash2 size={20} />
                          </button>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        )}
      </div>

      {/* Bottom Actions (apenas na view de horas) */}
      {currentView === 'hours' && (
        <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 p-4 shadow-lg">
          <button
            onClick={() => {
              if (confirm('Limpar todas as horas deste dia?')) {
                setDailyData(prev => ({
                  ...prev,
                  [selectedDate]: createDayStructure()
                }));
                setEditingHour(null);
              }
            }}
            className="w-full py-3 bg-slate-100 text-black rounded-xl font-semibold active:bg-slate-200 transition-colors"
          >
            Limpar Dia
          </button>
        </div>
      )}

      {/* Botão Flutuante de Adicionar Rápido */}
      <button
        onClick={() => setShowQuickAdd(true)}
        className="fixed bottom-20 right-4 w-14 h-14 bg-black text-white rounded-full shadow-2xl active:scale-95 transition-all flex items-center justify-center z-20"
      >
        <Plus size={28} strokeWidth={2.5} />
      </button>

      {/* Modal de Adição Rápida */}
      {showQuickAdd && (
        <div className="fixed inset-0 bg-black/50 z-30 flex items-end sm:items-center justify-center p-4">
          <div className="bg-white rounded-t-3xl sm:rounded-3xl w-full max-w-md shadow-2xl">
            <div className="p-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-xl font-bold text-black">Adicionar Receita Agora</h2>
                <button
                  onClick={() => {
                    setShowQuickAdd(false);
                    setQuickAddValue('');
                  }}
                  className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center active:bg-slate-200 text-2xl leading-none"
                >
                  ×
                </button>
              </div>

              <div className="space-y-4">
                <div className="bg-slate-50 rounded-xl p-4 border border-slate-200">
                  <div className="text-sm text-slate-600 mb-1">Data e Hora Atual</div>
                  <div className="text-lg font-bold text-black">
                    {new Date().toLocaleDateString('pt-BR', { 
                      day: '2-digit', 
                      month: 'long',
                      year: 'numeric'
                    })}
                  </div>
                  <div className="text-sm text-slate-500 mt-1">
                    {formatHour(new Date().getHours())} - {getDayName(getDateKey(new Date()))}
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-semibold text-slate-700 mb-2">
                    Valor Recebido
                  </label>
                  <input
                    type="number"
                    value={quickAddValue}
                    onChange={(e) => setQuickAddValue(e.target.value)}
                    placeholder="0.00"
                    className="w-full px-4 py-4 border-2 border-slate-300 rounded-xl focus:border-black focus:outline-none text-2xl font-bold text-black"
                    step="0.01"
                    min="0"
                    autoFocus
                  />
                </div>

                <div className="grid grid-cols-4 gap-2">
                  {[10, 50, 100, 500].map(amount => (
                    <button
                      key={amount}
                      onClick={() => setQuickAddValue(amount.toString())}
                      className="py-3 bg-slate-100 text-black rounded-lg font-semibold active:bg-slate-200 transition-colors"
                    >
                      {amount}
                    </button>
                  ))}
                </div>

                <button
                  onClick={handleQuickAdd}
                  disabled={!quickAddValue || parseFloat(quickAddValue) <= 0}
                  className="w-full py-4 bg-black text-white rounded-xl font-bold text-lg active:bg-slate-800 transition-colors disabled:bg-slate-300 disabled:text-slate-500"
                >
                  Adicionar {quickAddValue && parseFloat(quickAddValue) > 0 ? formatCurrency(parseFloat(quickAddValue)) : ''}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}